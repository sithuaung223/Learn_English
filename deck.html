<!DOCTYPE html>
<html>
<body>
<script type="text/javascript" src="vocabulary.json"></script>
<script src="canvas.js"></script>
<script src="deck.js"></script>

<script>
var flash_card_dict = {}
function getParamFromURL(param) {
	var url_string = window.location.href;
	var url = new URL(url_string);
	var value = url.searchParams.get(param);
	return value;
}

function main(){
	var selected_category = getParamFromURL("category");
	var vocabulary = JSON.parse(data);
	var meaning_dict = vocabulary[selected_category];

	var deck = {
		cards:[]
	};
	var filtered_deck = {
		cards:[]
	};

	deck.cards = createDeckWithDictionary(document, meaning_dict, flash_card_dict);
	var current_card_btn = deck.cards[0]

	var prev_btn = createButton(document, 'prev');
	var next_btn = createButton(document, 'next');

	var p_btn = {
		current: prev_btn,
		prev: prev_btn,
		next: next_btn
	};
	var n_btn = {
		current: next_btn,
		prev: prev_btn,
		next: next_btn
	};

	var isLearned = createCheckBoxWithLabel("isLearned", "isLearned");
	var isFiltered = createCheckBoxWithLabel("isFiltered", "isFiltered");

    prev_btn.onclick = function() {
    	var display_deck;
    	if (isFiltered.checked)
    		display_deck = filtered_deck;
    	else
    		display_deck = deck;

	   	current_card_btn = replaceWithNewCardBtn(document, deck, current_card_btn, p_btn, isLearned.checked);
	   	isLearned.checked = cardBtnIsLearned(current_card_btn);
    };
    next_btn.onclick = function() {
    	var display_deck;
    	if (isFiltered.checked)
    		display_deck = filtered_deck;
    	else
    		display_deck = deck;

	   	current_card_btn = replaceWithNewCardBtn(document, display_deck, current_card_btn, n_btn, isLearned.checked);
	   	isLearned.checked = cardBtnIsLearned(current_card_btn);
    };
    isFiltered.onclick = function() {
		flash_card_dict[current_card_btn.id].card.isLearned = isLearned.checked; 

		var new_card_btn = deck.cards[0];
		if (isFiltered.checked) {
 			filtered_deck = getFilteredDeck(deck, filtered_deck);
 			new_card_btn = filtered_deck.cards[0];
		}

		document.body.removeChild(current_card_btn);
    	insertNewCard(document, new_card_btn, next_btn);

    	current_card_btn = new_card_btn;
	   	isLearned.checked = cardBtnIsLearned(current_card_btn);
    }


	document.body.appendChild(prev_btn);
	document.body.appendChild(current_card_btn);
	document.body.appendChild(next_btn);
	
	document.write("<br>");
	var isLearnedLabel = createLabelForCheckBox("isLearned");
	document.body.appendChild(isLearnedLabel);
	document.body.appendChild(isLearned);

	document.write("<br>");
	var isFilteredLabel = createLabelForCheckBox("isFiltered");
	document.body.appendChild(isFilteredLabel);
	document.body.appendChild(isFiltered);
}

main();
</script> 

</body>
</html>

